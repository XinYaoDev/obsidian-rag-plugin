/* =========================================
   主容器布局：Flex 列布局，占满全高
========================================= */
.rag-chat-container {
    /* RAG 视图专用调色板（浅色） */
    --rag-surface: #F6F7FB;
    --rag-card: #FFFFFF;
    --rag-secondary: #EEF2FF;
    --rag-primary: #4A6BFF;
    --rag-primary-hover: #6380FF;
    --rag-border: #E3E6EF;
    --rag-border-strong: #D5DBEA;
    --rag-muted: #5C6373;
    --rag-text: #1F2430;
    --rag-accent-rgb: 74, 107, 255;
    --rag-success: #35C27A;
    --rag-success-subtle: #E7F6EF;
    --rag-success-hover: #D3F0E0;
    --rag-error: #F35B5B;
    --rag-error-subtle: #FFE9E9;
    --rag-error-hover: #FFE1E1;

    /* 将 Obsidian 变量映射为本视图的专属色板，局部生效 */
    --background-primary: var(--rag-surface);
    --background-primary-alt: #E9F0FF;
    --background-secondary: var(--rag-card);
    --background-secondary-alt: var(--rag-secondary);
    --background-modifier-border: var(--rag-border);
    --background-modifier-border-hover: var(--rag-border-strong);
    --background-modifier-border-focus: rgba(var(--rag-accent-rgb), 0.18);
    --background-modifier-hover: var(--rag-secondary);
    --background-modifier-success: var(--rag-success-subtle);
    --background-modifier-success-hover: var(--rag-success-hover);
    --background-modifier-error: var(--rag-error);
    --background-modifier-error-subtle: var(--rag-error-subtle);
    --background-modifier-error-hover: var(--rag-error-hover);
    --interactive-accent: var(--rag-primary);
    --interactive-accent-hover: var(--rag-primary-hover);
    --interactive-accent-rgb: var(--rag-accent-rgb);
    --text-normal: var(--rag-text);
    --text-muted: var(--rag-muted);
    --text-accent: var(--rag-primary);
    --text-on-accent: #FFFFFF;
    --text-error: var(--rag-error);
    --text-success: var(--rag-success);

    display: flex;
    flex-direction: column;
    height: 100%;   
    overflow: hidden; /* 隐藏溢出，交给子元素滚动 */
    background-color: var(--background-primary);
    padding: 0 !important; /* 覆盖原来可能有的 padding */
    font-family: "Inter", "SF Pro Text", "SF Pro Display", "Segoe UI", "Helvetica Neue", Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* 深色主题适配 */
.theme-dark .rag-chat-container {
    --rag-surface: #0F1117;
    --rag-card: #151925;
    --rag-secondary: #1E2433;
    --rag-primary: #6E8CFF;
    --rag-primary-hover: #8CA4FF;
    --rag-border: #252C3A;
    --rag-border-strong: #2F384A;
    --rag-muted: #A8B2C7;
    --rag-text: #E8ECF5;
    --rag-accent-rgb: 110, 140, 255;
    --rag-success: #4CD89D;
    --rag-success-subtle: #1F3A2F;
    --rag-success-hover: #214737;
    --rag-error: #F88484;
    --rag-error-subtle: #2B1A1A;
    --rag-error-hover: #3A1F1F;

    --background-primary: var(--rag-surface);
    --background-primary-alt: #1A1F2C;
    --background-secondary: var(--rag-card);
    --background-secondary-alt: var(--rag-secondary);
    --background-modifier-border: var(--rag-border);
    --background-modifier-border-hover: var(--rag-border-strong);
    --background-modifier-border-focus: rgba(var(--rag-accent-rgb), 0.32);
    --background-modifier-hover: var(--rag-secondary);
    --background-modifier-success: var(--rag-success-subtle);
    --background-modifier-success-hover: var(--rag-success-hover);
    --background-modifier-error: var(--rag-error);
    --background-modifier-error-subtle: var(--rag-error-subtle);
    --background-modifier-error-hover: var(--rag-error-hover);
    --interactive-accent: var(--rag-primary);
    --interactive-accent-hover: var(--rag-primary-hover);
    --interactive-accent-rgb: var(--rag-accent-rgb);
    --text-normal: var(--rag-text);
    --text-muted: var(--rag-muted);
    --text-accent: var(--rag-primary);
    --text-on-accent: #0F1117;
    --text-error: var(--rag-error);
    --text-success: var(--rag-success);
}

/* =========================================
   1. 顶部区域样式 (Header)
========================================= */
.chat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    border-bottom: 1px solid var(--background-modifier-border);
    background-color: var(--background-secondary);
    flex-shrink: 0;
    position: relative; /* 新增：为下拉菜单提供定位上下文 */
}

.chat-header h4 {
    margin: 0;
    font-size: 1.1em;
    font-weight: 600;
}

/* (可选) 如果你以后想加回顶部标签，保留这些样式没坏处 */
.model-select-container {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.9em;
    color: var(--text-muted);
}
.current-provider-badge {
    font-size: 0.75em;
    background-color: var(--background-modifier-border);
    padding: 2px 6px;
    border-radius: 4px;
    color: var(--text-muted);
    font-weight: 600;
    letter-spacing: 0.5px;
}

/* =========================================
   2. 中间消息区域样式 (Scrollable)
========================================= */
.chat-messages {
    flex-grow: 1;
    overflow-y: auto;
    padding: 20px 16px;
    display: flex;
    flex-direction: column;
    gap: 20px; /* 消息气泡之间的间距 */
}

/* 消息包装器 (用于左右对齐) */
.chat-message-wrapper {
    display: flex;
    width: 100%;
}
.chat-message-wrapper.user {
    justify-content: flex-end;
}
.chat-message-wrapper.ai {
    justify-content: flex-start;
}

/* 消息气泡基础样式 */
.chat-message-bubble {
    padding: 12px 16px;
    border-radius: 18px;
    max-width: 85%;
    
    /* 关键：让 HTML 标签控制排版，消除幽灵换行 */
    white-space: normal; 
    
    font-size: 0.95em;
    line-height: 1.5;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    
    /* 防止长单词撑爆容器 */
    overflow-wrap: break-word;
    word-break: break-word;
    
    /* 支持文本选择 */
    user-select: text;
    cursor: text;
    
    /* 相对定位，为复制按钮提供定位上下文 */
    position: relative;
}

/* 用户气泡颜色 */
.chat-message-bubble.user {
    background: linear-gradient(135deg, #EFF3FF, #E6EDFF);
    color: var(--rag-text);
    border: 1px solid var(--rag-border);
    border-bottom-right-radius: 4px;
}

/* 深色模式下的用户气泡：提高对比度与文字可读性 */
.theme-dark .chat-message-bubble.user {
    background: linear-gradient(135deg, #24304a, #1c263a);
    color: #E8ECF5;
    border: 1px solid #2F384A;
}

/* AI 气泡颜色 */
.chat-message-bubble.ai {
    background-color: var(--background-secondary-alt);
    border: 1px solid var(--background-modifier-border);
    color: var(--text-normal);
    border-bottom-left-radius: 4px;
    /* 为底部操作按钮预留空间 */
    padding-bottom: 64px;
}

/* 错误消息样式 */
.chat-message-bubble.error {
    background-color: var(--background-modifier-error-subtle);
    color: var(--text-error);
    border: 1px solid var(--background-modifier-error);
}

/* 错误消息内的链接颜色 */
.chat-message-bubble.error a {
    color: var(--text-error);
    text-decoration: underline;
}

/* Loading 动画样式 */
.chat-message-bubble.loading {
    background-color: transparent;
    border: none;
    box-shadow: none;
    padding: 8px;
    color: var(--text-muted);
    display: flex;
    align-items: center;
}
.chat-message-bubble.loading svg {
    width: 24px;
    height: 24px;
    animation: spin 1s linear infinite;
}
@keyframes spin {
    100% { transform: rotate(360deg); }
}

/* =========================================
   3. 底部输入区域样式 (Fixed Bottom)
========================================= */
.chat-input-area {
    padding: 16px;
    border-top: 1px solid var(--background-modifier-border);
    background-color: var(--background-secondary);
    display: flex;
    flex-direction: column; /* 修改为列布局以容纳开关 */
    gap: 12px;
    flex-shrink: 0;
    /* 避开右下角悬浮状态窗的遮挡 */
    margin-bottom: 20px;
}

/* 深度思考开关容器 */
.deep-thinking-toggle-container {
    display: flex;
    align-items: center;
    justify-content: flex-start;
}

/* 深度思考开关基础样式 */
.deep-thinking-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    border-radius: 8px;
    cursor: pointer;
    user-select: none;
    transition: all 0.3s ease;
    background-color: var(--background-primary);
    border: 1px solid var(--background-modifier-border);
}

/* 开关图标样式 */
.deep-thinking-toggle .toggle-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.deep-thinking-toggle .toggle-icon svg {
    width: 18px;
    height: 18px;
}

/* 开关文字标签 */
.deep-thinking-toggle .toggle-label {
    font-size: 0.9em;
    font-weight: 500;
    transition: all 0.3s ease;
}

/* 激活状态（亮） */
.deep-thinking-toggle.active {
    background-color: var(--interactive-accent);
    border-color: var(--interactive-accent);
    box-shadow: 0 0 8px rgba(var(--interactive-accent-rgb), 0.3);
}

.deep-thinking-toggle.active .toggle-icon {
    color: var(--text-on-accent);
}

.deep-thinking-toggle.active .toggle-icon svg {
    color: var(--text-on-accent);
    filter: drop-shadow(0 0 4px rgba(255, 215, 0, 0.6));
}

.deep-thinking-toggle.active .toggle-label {
    color: var(--text-on-accent);
}

/* 非激活状态（暗） */
.deep-thinking-toggle.inactive {
    opacity: 0.6;
}

.deep-thinking-toggle.inactive .toggle-icon {
    color: var(--text-muted);
}

.deep-thinking-toggle.inactive .toggle-icon svg {
    color: var(--text-muted);
}

.deep-thinking-toggle.inactive .toggle-label {
    color: var(--text-muted);
}

/* 悬停效果 */
.deep-thinking-toggle:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.deep-thinking-toggle.active:hover {
    box-shadow: 0 2px 8px rgba(var(--interactive-accent-rgb), 0.4);
}

.deep-thinking-toggle.inactive:hover {
    opacity: 0.8;
}

/* 输入框和发送按钮的行容器 */
.input-row-container {
    display: flex;
    align-items: flex-end;
    gap: 12px;
    width: 100%;
}

/* 输入框外框 */
.input-box-container {
    flex-grow: 1;
    display: flex;
    border: 1px solid var(--background-modifier-border-hover);
    border-radius: 12px;
    background-color: var(--background-primary);
    padding: 10px 12px;
    transition: all 0.2s ease;
}
.input-box-container:focus-within {
    border-color: var(--interactive-accent);
    box-shadow: 0 0 0 2px var(--background-modifier-border-focus);
}

/* 输入框本体 */
.chat-input {
    flex-grow: 1;
    border: none;
    background: transparent;
    resize: none;
    max-height: 200px;
    min-height: 24px;
    padding: 0;
    margin: 0;
    outline: none;
    font-family: inherit;
    font-size: inherit;
    line-height: 1.5;
    overflow-y: auto;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/* ContentEditable 输入框的 placeholder 效果 */
.chat-input:empty:before {
    content: attr(data-placeholder);
    color: var(--text-muted);
    pointer-events: none;
}

/* 输入框内的内部链接样式 */
.chat-input a.internal-link {
    color: var(--interactive-accent);
    text-decoration: none;
    border-bottom: 1px solid var(--interactive-accent);
    cursor: pointer;
    transition: all 0.2s ease;
}

.chat-input a.internal-link:hover {
    color: var(--interactive-accent-hover);
    border-bottom-color: var(--interactive-accent-hover);
    background-color: var(--background-modifier-hover);
    padding: 0 2px;
    border-radius: 3px;
}

/* 发送按钮 */
.chat-send-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--interactive-accent), #7FA1FF);
    color: var(--text-on-accent);
    border: none;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.1s ease;
    padding: 0;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
.chat-send-btn:hover {
    background: linear-gradient(135deg, var(--interactive-accent-hover), #96B1FF);
}
.chat-send-btn:active {
    transform: scale(0.95);
}
.chat-send-btn svg {
    width: 20px;
    height: 20px;
}

/* 终止按钮样式 */
.chat-send-btn.stop-btn {
    background: var(--interactive-accent);
    color: var(--text-on-accent);
    transition: background-color 0.2s ease, transform 0.1s ease, color 0.2s ease, box-shadow 0.2s ease;
}

/* 终止按钮悬停/聚焦时变成红色警示 */
.chat-send-btn.stop-btn:hover,
.chat-send-btn.stop-btn:focus-visible {
    background: #dc3545 !important; /* 红色警示色 */
    color: #fff !important;
    box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.18);
}

.chat-send-btn.stop-btn:active {
    background: #c82333 !important; /* 更深的红色 */
    color: #fff !important;
    transform: scale(0.95);
}

/* ============================================================
   Markdown 渲染紧凑模式 (Compact Mode)
   强制覆盖 Obsidian 默认的大间距样式，避免气泡内空旷
============================================================ */

/* 1. 消除段落的大间距 */
.chat-message-bubble p {
    margin-block-start: 6px !important;
    margin-block-end: 6px !important;
}

/* 2. 消除首尾元素的额外间距 (防止气泡顶部底部留白) */
.chat-message-bubble > *:first-child {
    margin-top: 0 !important;
    padding-top: 0 !important;
}
.chat-message-bubble > *:last-child {
    margin-bottom: 0 !important;
    padding-bottom: 0 !important;
}

/* 3. 列表紧凑化 */
.chat-message-bubble ul, 
.chat-message-bubble ol {
    margin-block-start: 4px !important;
    margin-block-end: 4px !important;
    padding-inline-start: 1.5em !important;
}

.chat-message-bubble li {
    margin: 0 !important;
}

/* 4. 代码块样式修正 */
.chat-message-bubble pre {
    margin: 8px 0 !important;
    padding: 8px !important;
    background-color: var(--background-primary-alt);
    border: 1px solid var(--background-modifier-border);
    border-radius: 4px;
    font-family: "JetBrains Mono", "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: 0.92em;
    line-height: 1.55;
}

/* 5. 标题紧凑化 */
.chat-message-bubble h1, 
.chat-message-bubble h2, 
.chat-message-bubble h3 {
    margin-block-start: 12px !important;
    margin-block-end: 6px !important;
    font-size: 1.1em !important;
    line-height: 1.2;
}

/* ============================================================
   修复列表“松散模式”导致的大间距
   (针对 li 内部包裹了 p 标签的情况)
============================================================ */

/* 强制去掉列表项内部段落的上下边距 */
.chat-message-bubble li p {
    margin-block-start: 0 !important;
    margin-block-end: 0 !important;
    margin-top: 0 !important;
    margin-bottom: 0 !important;
    display: inline-block; /* 或者是 block，视情况而定，inline-block通常能紧凑布局 */
}

/* 确保列表项本身也没有间距 */
.chat-message-bubble li {
    margin: 0 !important;
    padding: 0 !important;
    line-height: 1.4 !important; /* 列表行高稍微紧凑一点 */
}

/* 再次加固：确保列表容器紧凑 */
.chat-message-bubble ul, 
.chat-message-bubble ol {
    margin-top: 4px !important;
    margin-bottom: 4px !important;
}

/* 修复：避免第一个列表项顶部有多余空白 */
.chat-message-bubble ul > li:first-child,
.chat-message-bubble ol > li:first-child {
    margin-top: 0 !important;
}

/* 顶部操作按钮（如清空按钮） */
.chat-header-btn {
    background: transparent;
    border: none;
    box-shadow: none;
    color: var(--text-muted); /* 默认灰色 */
    cursor: pointer;
    padding: 6px; /* 稍微大一点的点击区域 */
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}

/* 悬停状态 - 强制变红 */
.chat-header-btn:hover {
    color: var(--text-error) !important; /* 强制变红 */
    background-color: var(--background-modifier-error-hover) !important; /* 红色浅背景 */
}

/* 确保内部图标也变色 */
.chat-header-btn:hover svg {
    color: var(--text-error) !important;
    stroke: var(--text-error) !important; /* 部分图标使用 stroke */
}

.chat-header-btn svg {
    width: 18px;
    height: 18px;
}

/* =========================================
   会话管理区域样式
========================================= */

/* 会话选择器容器 */
.session-selector-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    border-bottom: 1px solid var(--background-modifier-border);
    background-color: var(--background-primary);
    gap: 12px;
}

/* 当前会话名称显示 */
.current-session-name {
    font-weight: 600;
    color: var(--text-accent);
    font-size: 1em;
    cursor: pointer;
    user-select: none;
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.current-session-name:hover {
    opacity: 0.8;
}

/* 会话操作按钮组 */
.session-actions {
    display: flex;
    gap: 8px;
    align-items: center;
}

.session-action-btn {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 6px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    transition: all 0.2s ease;
}

.session-action-btn:hover {
    background-color: var(--background-modifier-hover);
    color: var(--text-normal);
}

.session-action-btn svg {
    width: 18px;
    height: 18px;
}

/* 删除按钮悬停时变红 */
.session-action-btn.delete:hover {
    background-color: var(--background-modifier-error-hover);
    color: var(--text-error);
}

/* 会话下拉菜单 */
.session-dropdown {
    position: absolute;
    top: 100%;
    left: 16px;
    right: 16px;
    margin-top: 4px;
    background-color: var(--background-primary);
    border: 1px solid var(--background-modifier-border);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    max-height: 400px;
    overflow-y: auto;
    z-index: 1000;
    padding: 8px;
}

/* 会话项 */
.session-item {
    display: flex;
    align-items: center;
    padding: 10px 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.2s ease;
    gap: 8px;
}

.session-item:hover {
    background-color: var(--background-modifier-hover);
}

.session-item.active {
    background-color: var(--background-modifier-border);
}

/* 激活状态标识 */
.session-item .check-icon {
    width: 16px;
    height: 16px;
    color: var(--text-accent);
    flex-shrink: 0;
}

.session-item:not(.active) .check-icon {
    opacity: 0;
}

/* 会话名称和信息 */
.session-info {
    flex: 1;
    min-width: 0;
}

.session-name {
    font-weight: 500;
    color: var(--text-normal);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.session-meta {
    font-size: 0.85em;
    color: var(--text-muted);
}

/* 会话项操作按钮 */
.session-item-actions {
    display: none;
    gap: 4px;
}

.session-item:hover .session-item-actions {
    display: flex;
}

.session-item-action {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    transition: all 0.2s ease;
}

.session-item-action:hover {
    background-color: var(--background-modifier-hover);
    color: var(--text-normal);
}

.session-item-action svg {
    width: 14px;
    height: 14px;
}

.session-item-action.delete:hover {
    background-color: var(--background-modifier-error-hover);
    color: var(--text-error);
}

/* 分隔线 */
.session-divider {
    height: 1px;
    background-color: var(--background-modifier-border);
    margin: 8px 4px;
}

/* 新建会话按钮 */
.new-session-btn {
    width: 100%;
    padding: 10px 12px;
    background: transparent;
    border: 1px dashed var(--background-modifier-border);
    border-radius: 6px;
    cursor: pointer;
    color: var(--text-accent);
    font-weight: 500;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.new-session-btn:hover {
    background-color: var(--background-modifier-hover);
    border-color: var(--text-accent);
}

/* 回收站下拉菜单 - 继承 session-dropdown 的样式 */

.trash-empty {
    padding: 20px;
    text-align: center;
    color: var(--text-muted);
    font-size: 0.9em;
}

.trash-item {
    opacity: 0.8;
}

.trash-item:hover {
    opacity: 1;
}

/* 恢复按钮 */
.session-item-action.restore:hover {
    background-color: var(--background-modifier-success-hover);
    color: var(--text-success);
}

/* 一键清空回收站按钮 */
.clear-all-trash-btn {
    width: 100%;
    padding: 10px 12px;
    background: transparent;
    border: 1px solid var(--background-modifier-border);
    border-radius: 6px;
    cursor: pointer;
    color: var(--text-error);
    font-weight: 500;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    margin-bottom: 8px;
}

.clear-all-trash-btn:hover {
    background-color: var(--background-modifier-error-hover);
    border-color: var(--text-error);
    color: var(--text-error);
}

/* 重命名输入框 */
.session-rename-input {
    background-color: var(--background-primary);
    border: 1px solid var(--interactive-accent);
    border-radius: 4px;
    padding: 4px 8px;
    font-size: inherit;
    font-weight: 500;
    color: var(--text-normal);
    outline: none;
    width: 100%;
}

.session-rename-input:focus {
    box-shadow: 0 0 0 2px var(--background-modifier-border-focus);
}

/* =========================================
   思考过程折叠面板样式
========================================= */

/* 思考过程区域外层容器 */
.thinking-panel {
    margin-bottom: 12px;
    border-radius: 6px;
    overflow: hidden;
}

/* 折叠面板头部（可点击区域） */
.thinking-panel__header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 12px;
    background-color: var(--background-secondary);
    border: 1px solid var(--background-modifier-border);
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.2s ease;
    font-size: 0.85em;
    color: var(--text-muted);
}

.thinking-panel__header:hover {
    background-color: var(--background-modifier-hover);
}

/* 展开/收起图标容器 */
.thinking-panel__icon {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: transform 0.2s ease;
}

.thinking-panel__icon svg {
    width: 14px;
    height: 14px;
    color: var(--text-muted);
}

/* 标题文字 */
.thinking-panel__title {
    font-weight: 500;
    flex-grow: 1;
}

/* 思考内容区域 */
.thinking-panel__content {
    background-color: var(--background-primary-alt);
    border: 1px solid var(--background-modifier-border);
    border-top: none;
    border-radius: 0 0 6px 6px;
    font-size: 0.85em;
    color: var(--text-muted);
    line-height: 1.5;
    overflow-y: auto;
    transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out, padding 0.3s ease-in-out;
}

/* 收起状态 */
.thinking-panel__content--collapsed {
    max-height: 0;
    opacity: 0;
    padding: 0;
    border: none;
}

/* 展开状态 */
.thinking-panel__content--expanded {
    max-height: 500px;
    opacity: 1;
    padding: 10px 12px;
}

/* 思考面板活跃状态（流式输出中）：移除滚动限制，让内容自然扩展 */
.thinking-panel--active .thinking-panel__content--expanded {
    max-height: none;
    overflow-y: visible;
}

/* 思考面板活跃状态（流式输出中） */
.thinking-panel--active {
    animation: pulse-border 2s ease-in-out infinite;
}

@keyframes pulse-border {
    0%, 100% {
        border-color: var(--background-modifier-border);
    }
    50% {
        border-color: var(--interactive-accent);
    }
}

.thinking-panel--active .thinking-panel__header {
    background-color: var(--background-modifier-hover);
}

/* 思考内容区域的 Markdown 紧凑样式 */
.thinking-panel__content p {
    margin-block-start: 4px !important;
    margin-block-end: 4px !important;
}

.thinking-panel__content > *:first-child {
    margin-top: 0 !important;
}

.thinking-panel__content > *:last-child {
    margin-bottom: 0 !important;
}

.thinking-panel__content ul,
.thinking-panel__content ol {
    margin-block-start: 4px !important;
    margin-block-end: 4px !important;
    padding-inline-start: 1.5em !important;
}

.thinking-panel__content li {
    margin: 0 !important;
}

.thinking-panel__content pre {
    margin: 6px 0 !important;
    padding: 6px !important;
    background-color: var(--background-primary);
    border: 1px solid var(--background-modifier-border);
    border-radius: 4px;
    font-size: 0.9em;
}

.thinking-panel__content code {
    background-color: var(--background-primary);
    padding: 2px 4px;
    border-radius: 3px;
    font-size: 0.9em;
}

.thinking-panel__content h1,
.thinking-panel__content h2,
.thinking-panel__content h3 {
    margin-block-start: 8px !important;
    margin-block-end: 4px !important;
    font-size: 1em !important;
    line-height: 1.2;
}

/* =========================================
   AI 消息底部操作区（折叠 / 复制 / 导出 / 删除）
========================================= */
.message-actions {
    position: absolute;
    left: 10px;
    bottom: 10px;
    display: inline-flex;
    gap: 8px;
    background: transparent;
    padding: 0;
    border-radius: 0;
    border: none;
    box-shadow: none;
    backdrop-filter: none;
    opacity: 0;
    transform: translateY(4px);
    transition: opacity 0.18s ease, transform 0.18s ease;
    z-index: 10;
}
.theme-dark .message-actions {
    background: transparent;
}

.chat-message-bubble.ai:hover .message-actions {
    opacity: 1;
    transform: translateY(0);
}

/* 折叠状态下隐藏操作区 */
.chat-message-bubble.message-folded .message-actions {
    display: none !important;
}

.message-action-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 6px 10px;
    border-radius: 8px;
    background-color: var(--background-secondary);
    border: 1px solid var(--background-modifier-border);
    cursor: pointer;
    font-size: 0.85em;
    color: var(--text-muted);
    user-select: none;
    line-height: 1;
    height: auto;
    transition: all 0.2s ease;
}

.message-action-btn:hover {
    background-color: var(--background-modifier-hover);
    color: var(--text-normal);
}

.message-action-btn.copy-btn--success {
    color: var(--interactive-accent);
    border-color: var(--interactive-accent);
    background-color: var(--background-modifier-success-hover);
}

.message-action-btn.busy {
    cursor: wait;
    opacity: 0.7;
}

/* 按钮图标 */
.copy-btn-icon {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    flex-shrink: 0;
    line-height: 1;
    vertical-align: middle;
}

.copy-btn-icon svg {
    width: 14px;
    height: 14px;
    display: block !important;
}

/* 按钮文字 */
.copy-btn-text {
    display: inline-flex !important;
    align-items: center !important;
    font-weight: 500;
    white-space: nowrap;
    line-height: 1 !important;
    flex-shrink: 0;
    vertical-align: middle;
    padding: 0;
    margin: 0;
}

/* =========================================
   消息折叠/展开功能样式
========================================= */

/* 消息内容容器 */
.message-content-container {
    position: relative;
}

/* 折叠状态下的消息气泡 */
.chat-message-bubble.message-folded {
    padding: 12px 16px;
    padding-bottom: 12px;
    min-height: auto;
}

/* 消息头部（折叠状态下显示） */
.message-header {
    display: none;
    align-items: center;
    gap: 12px;
    padding: 8px 0;
    font-size: 0.85em;
    color: var(--text-muted);
    border-bottom: 1px solid var(--background-modifier-border);
    margin-bottom: 8px;
}

.chat-message-bubble.message-folded .message-header {
    display: flex;
}

.message-header-model {
    font-weight: 600;
    color: var(--text-normal);
}

.message-header-time {
    font-size: 0.9em;
    color: var(--text-muted);
}

/* 展开按钮（折叠状态下显示在右侧） */
.message-expand-btn {
    position: absolute;
    right: 10px;
    top: 10px;
    display: none;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 6px 10px;
    border-radius: 8px;
    background-color: var(--background-secondary);
    border: 1px solid var(--background-modifier-border);
    cursor: pointer;
    font-size: 0.85em;
    color: var(--text-muted);
    user-select: none;
    line-height: 1;
    height: auto;
    transition: all 0.2s ease;
    z-index: 10;
}

.message-expand-btn:hover {
    background-color: var(--background-modifier-hover);
    color: var(--text-normal);
}

/* 折叠状态下显示展开按钮 */
.chat-message-bubble.message-folded .message-expand-btn {
    display: flex;
}

/* 删除按钮特殊样式 */
.message-delete-btn:hover {
    background-color: var(--background-modifier-error);
    color: var(--text-error);
    border-color: var(--background-modifier-error);
}

/* =========================================
   代码块包裹容器和复制按钮样式
========================================= */

/* 代码块外层包裹容器 */
.code-block-wrapper {
    position: relative;
    margin: 8px 0;
    border-radius: 6px;
    overflow: hidden;
    border: 1px solid var(--background-modifier-border);
}

/* 代码块Header Bar */
.code-block-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background-color: var(--background-secondary);
    border-bottom: 1px solid var(--background-modifier-border);
}

/* 代码语言标签（左侧） */
.code-language-label {
    font-size: 0.75em;
    color: var(--text-muted);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    user-select: none;
}

/* 代码块复制按钮（右侧） */
.code-copy-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 8px;
    border-radius: 4px;
    background-color: transparent;
    border: 1px solid transparent;
    cursor: pointer;
    opacity: 0;
    transition: all 0.2s ease;
    font-size: 0.8em;
    color: var(--text-muted);
    user-select: none;
}

/* 悬停时显示复制按钮 */
.code-block-wrapper:hover .code-copy-btn {
    opacity: 1;
}

.code-copy-btn:hover {
    background-color: var(--background-modifier-hover);
    border-color: var(--background-modifier-border);
    color: var(--text-normal);
}

/* 成功状态 */
.code-copy-btn.copy-btn--success {
    opacity: 1;
    color: var(--interactive-accent);
    border-color: var(--interactive-accent);
    background-color: var(--background-modifier-success);
}

/* 调整代码块本身样式 */
.code-block-wrapper pre {
    margin: 0;
    border-radius: 0;
    border: none;
    font-family: "JetBrains Mono", "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: 0.92em;
    line-height: 1.55;
}

/* =========================================
   隐藏代码块内部的冗余元素
========================================= */

/* 隐藏代码块内部的语言标签水印（可能由渲染器自动生成） */
.code-block-wrapper pre::after,
.code-block-wrapper pre::before,
.code-block-wrapper code::after,
.code-block-wrapper code::before {
    display: none !important;
    content: none !important;
}

/* 隐藏代码块内部可能存在的语言标签元素 */
.code-block-wrapper pre code::before,
.code-block-wrapper pre code::after {
    display: none !important;
    content: none !important;
}

/* 确保代码块内部没有额外的语言标签显示 */
.code-block-wrapper code[class*="language-"]::before,
.code-block-wrapper code[class*="language-"]::after {
    display: none !important;
    content: none !important;
}

/* 隐藏Obsidian或第三方插件生成的复制按钮（排除我们自定义的按钮） */
.code-block-wrapper .copy-code-button,
.code-block-wrapper .copy-button,
.code-block-wrapper .clipboard-copy,
.code-block-wrapper .clipboard-button {
    display: none !important;
}

/* 隐藏其他可能的第三方复制按钮（但排除我们的.code-copy-btn和.message-copy-full-btn） */
.code-block-wrapper button[class*="copy"]:not(.code-copy-btn),
.code-block-wrapper button[class*="clipboard"] {
    display: none !important;
}

/* 隐藏可能的语言标签元素 */
.code-block-wrapper .language-label:not(.code-language-label),
.code-block-wrapper .lang-label,
.code-block-wrapper [data-language]::after,
.code-block-wrapper [class*="language-"]::after {
    display: none !important;
}

/* 确保只有我们自定义的Header中的元素可见 */
.code-block-wrapper > *:not(.code-block-header):not(pre) {
    display: none !important;
}

/* =========================================
   流式对话相关样式
========================================= */

/* 回答内容容器 */
.answer-content {
    position: relative;
}

/* Loading 指示器 */
.loading-indicator {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 12px;
    color: var(--text-muted);
}

.loading-indicator svg {
    width: 24px;
    height: 24px;
    animation: spin 1s linear infinite;
}

/* 打字机光标效果（可选，在流式输出时显示） */
.answer-content.streaming::after {
    content: '▋';
    color: var(--interactive-accent);
    animation: blink 1s infinite;
    margin-left: 2px;
}

@keyframes blink {
    0%, 50% {
        opacity: 1;
    }
    51%, 100% {
        opacity: 0;
    }
}

/* ===========================
   Model 设置页表格样式
=========================== */
.settings-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
}
.tab-btn {
    padding: 6px 12px;
    border: 1px solid var(--background-modifier-border);
    background: var(--background-secondary);
    border-radius: 6px;
    cursor: pointer;
}
.tab-btn.active {
    border-color: var(--interactive-accent);
    color: var(--interactive-accent);
    box-shadow: 0 0 0 2px var(--background-modifier-border-focus);
}

.model-tab-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 12px 0;
}
.model-add-btn {
    padding: 6px 12px;
    border: 1px solid var(--background-modifier-border);
    border-radius: 6px;
    background: var(--background-secondary);
    cursor: pointer;
}

.model-table {
    width: 100%;
    border: 1px solid var(--background-modifier-border);
    border-radius: 8px;
    overflow: hidden;
}
.model-table__head,
.model-row {
    display: grid;
    grid-template-columns: 2fr 1.6fr 0.8fr 1.2fr;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
}
.model-table__head {
    background: var(--background-secondary);
    font-weight: 600;
    border-bottom: 1px solid var(--background-modifier-border);
}
.model-row {
    border-bottom: 1px solid var(--background-modifier-border);
}
.model-row:last-child {
    border-bottom: none;
}
.model-col--actions {
    display: flex;
    gap: 8px;
}
.model-col--actions .icon-btn {
    padding: 4px 8px;
    border: 1px solid var(--background-modifier-border);
    border-radius: 6px;
    background: var(--background-secondary);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    font-size: 14px;
    line-height: 1;
}

/* Chat 界面模型选择下拉 */
.llm-inline-dropdown {
    background: var(--background-secondary);
    border: 1px solid var(--background-modifier-border);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    padding: 8px;
    min-width: 180px;
    z-index: 10;
}
.llm-inline-dropdown.llm-float {
    position: fixed;
}
.llm-inline-item {
    padding: 6px 8px;
    border-radius: 6px;
    cursor: pointer;
}
.llm-inline-item:hover {
    background: var(--background-modifier-hover);
}